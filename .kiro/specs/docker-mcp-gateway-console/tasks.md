# 実装計画

- [x] 1. プロジェクト構造とコア設定のセットアップ
  - Next.js 14（App Router）とFastAPIのプロジェクト構造を作成
  - TypeScript、Tailwind CSS、Pythonの依存関係をインストール
  - Docker Compose設定を作成（開発環境用）
  - 環境変数の設定ファイルを作成
  - _Requirements: すべての要件の基盤_

- [x] 2. バックエンド: Secret Manager実装
  - Bitwarden CLI wrapperを実装
  - Bitwarden参照記法のパーサーを実装（`{{ bw:item-id:field }}`）
  - Secret解決メソッドを実装
  - メモリ内キャッシュ機構を実装
  - _Requirements: 2.1, 2.2, 2.4, 7.1, 7.3_

- [x] 2.1 Secret Managerのプロパティテストを作成
  - **Property 5: Bitwarden参照記法の受け入れ**
  - **検証対象: 要件 2.1, 2.5, 5.3**
  - _Requirements: 2.1, 2.5, 5.3_

- [x] 2.2 Secret解決のプロパティテストを作成
  - **Property 6: 参照記法の解決**
  - **検証対象: 要件 2.2**
  - _Requirements: 2.2_

- [x] 2.3 無効な参照のエラーハンドリングテストを作成
  - **Property 7: 無効な参照のエラーハンドリング**
  - **検証対象: 要件 2.3**
  - _Requirements: 2.3_

- [x] 2.4 機密情報のディスク書き込み禁止テストを作成
  - **Property 8: 機密情報のディスク書き込み禁止**
  - **検証対象: 要件 2.4, 7.3**
  - _Requirements: 2.4, 7.3_

- [x] 2.5 Secretキャッシングのプロパティテストを作成
  - **Property 23: Secretのキャッシング**
  - **検証対象: 要件 7.1, 7.4**
  - _Requirements: 7.1, 7.4_

- [x] 2.6 キャッシュ有効期限のプロパティテストを作成 (P)
  - **Property 25: キャッシュ有効期限**
  - **検証対象: 要件 7.5**
  - _Requirements: 7.5_

- [x] 3. バックエンド: Auth Service実装
  - Bitwarden認証フローを実装（APIキー、マスターパスワード）
  - セッション管理機構を実装（UUID生成、有効期限管理）
  - セッションタイムアウト処理を実装
  - ログアウト処理を実装
  - _Requirements: 1.1, 1.2, 1.3, 1.4, 1.5_

- [ ] 3.1 認証成功時のセッション確立テストを作成 (P)
  - **Property 1: 認証成功時のセッション確立**
  - **検証対象: 要件 1.1, 1.2**
  - _Requirements: 1.1, 1.2_

- [ ] 3.2 認証失敗時のセッション非確立テストを作成 (P)
  - **Property 2: 認証失敗時のセッション非確立**
  - **検証対象: 要件 1.3**
  - _Requirements: 1.3_

- [ ] 3.3 セッションタイムアウトのプロパティテストを作成 (P)
  - **Property 3: セッションタイムアウト**
  - **検証対象: 要件 1.4**
  - _Requirements: 1.4_

- [ ] 3.4 ログアウト時のセッション終了テストを作成 (P)
  - **Property 4: ログアウト時のセッション終了**
  - **検証対象: 要件 1.5**
  - _Requirements: 1.5_

- [ ] 3.5 セッション終了時のキャッシュクリアテストを作成 (P)
  - **Property 24: セッション終了時のキャッシュクリア**
  - **検証対象: 要件 7.2**
  - _Requirements: 7.2_

- [x] 4. バックエンド: Container Service実装
  - Docker SDK for Pythonを統合
  - コンテナ一覧取得メソッドを実装
  - コンテナ作成・起動メソッドを実装（Secret解決を含む）
  - コンテナ停止・再起動・削除メソッドを実装
  - ログストリーミング機能を実装（WebSocket）
  - _Requirements: 4.1, 4.2, 4.3, 4.4, 4.5_

- [ ] 4.1 コンテナ作成と起動のプロパティテストを作成 (P)
  - **Property 12: コンテナ作成と起動**
  - **検証対象: 要件 4.1**
  - _Requirements: 4.1_

- [ ] 4.2 コンテナ停止のプロパティテストを作成 (P)
  - **Property 13: コンテナ停止**
  - **検証対象: 要件 4.2**
  - _Requirements: 4.2_

- [ ] 4.3 コンテナ再起動のプロパティテストを作成 (P)
  - **Property 14: コンテナ再起動**
  - **検証対象: 要件 4.3**
  - _Requirements: 4.3_

- [ ] 4.4 コンテナ削除のプロパティテストを作成 (P)
  - **Property 15: コンテナ削除**
  - **検証対象: 要件 4.4**
  - _Requirements: 4.4_

- [ ] 4.5 コンテナログ取得のプロパティテストを作成 (P)
  - **Property 16: コンテナログの取得**
  - **検証対象: 要件 4.5**
  - _Requirements: 4.5_

- [x] 5. バックエンド: Catalog Service実装
  - Catalog取得メソッドを実装（HTTP fetch）
  - Catalogキャッシュ機構を実装
  - 検索・フィルタリングメソッドを実装
  - エラーハンドリングとフォールバック処理を実装
  - _Requirements: 3.1, 3.4, 3.5, 8.1, 8.2, 8.4, 8.5_

- [ ] 5.1 Catalogデータ取得のプロパティテストを作成 (P)
  - **Property 9: Catalogデータの取得**
  - **検証対象: 要件 3.1, 3.4**
  - _Requirements: 3.1, 3.4_

- [ ] 5.2 Catalog接続失敗時のフォールバックテストを作成 (P)
  - **Property 11: Catalog接続失敗時のフォールバック**
  - **検証対象: 要件 3.5**
  - _Requirements: 3.5_

- [ ] 5.3 キーワード検索のプロパティテストを作成 (P)
  - **Property 26: キーワード検索**
  - **検証対象: 要件 8.1**
  - _Requirements: 8.1_

- [ ] 5.4 カテゴリフィルタリングのプロパティテストを作成 (P)
  - **Property 27: カテゴリフィルタリング**
  - **検証対象: 要件 8.2**
  - _Requirements: 8.2_

- [ ] 5.5 検索リセットのプロパティテストを作成 (P)
  - **Property 28: 検索リセット**
  - **検証対象: 要件 8.4**
  - _Requirements: 8.4_

- [ ] 5.6 複合フィルタリングのプロパティテストを作成 (P)
  - **Property 29: 複合フィルタリング**
  - **検証対象: 要件 8.5**
  - _Requirements: 8.5_

- [x] 6. バックエンド: Config Service実装
  - Gateway設定ファイルの読み込みメソッドを実装
  - Gateway設定ファイルの書き込みメソッドを実装
  - 設定バリデーション機能を実装（Pydantic）
  - エラーハンドリングを実装
  - _Requirements: 5.1, 5.2, 5.3, 5.4, 5.5_

- [ ] 6.1 設定読み込みのプロパティテストを作成 (P)
  - **Property 17: 設定の読み込み**
  - **検証対象: 要件 5.1**
  - _Requirements: 5.1_

- [ ] 6.2 設定のラウンドトリップテストを作成 (P)
  - **Property 18: 設定のラウンドトリップ**
  - **検証対象: 要件 5.2**
  - _Requirements: 5.2_

- [ ] 6.3 無効な設定の拒否テストを作成 (P)
  - **Property 19: 無効な設定の拒否**
  - **検証対象: 要件 5.4**
  - _Requirements: 5.4_

- [ ] 6.4 設定書き込み失敗のエラーハンドリングテストを作成 (P)
  - **Property 20: 設定書き込み失敗のエラーハンドリング**
  - **検証対象: 要件 5.5**
  - _Requirements: 5.5_

- [x] 7. バックエンド: Inspector Service実装
  - MCPプロトコル通信ライブラリを統合
  - MCPサーバーへの接続メソッドを実装
  - Tools/Resources/Prompts取得メソッドを実装
  - エラーハンドリングを実装
  - _Requirements: 6.1, 6.2, 6.3, 6.4, 6.5_

- [ ] 7.1 MCP機能情報取得のプロパティテストを作成 (P)
  - **Property 21: MCP機能情報の取得**
  - **検証対象: 要件 6.1, 6.2, 6.3, 6.5**
  - _Requirements: 6.1, 6.2, 6.3, 6.5_

- [ ] 7.2 MCP接続失敗のエラーハンドリングテストを作成 (P)
  - **Property 22: MCP接続失敗のエラーハンドリング**
  - **検証対象: 要件 6.4**
  - _Requirements: 6.4_

- [x] 8. バックエンド: FastAPI エンドポイント実装
  - 認証エンドポイント（login, logout, session）を実装
  - Catalogエンドポイント（list, search）を実装
  - コンテナエンドポイント（CRUD, logs）を実装
  - Gateway設定エンドポイント（read, write）を実装
  - Inspectorエンドポイント（tools, resources, prompts）を実装
  - エラーハンドラーを実装
  - _Requirements: すべての要件_

- [ ] 8.1 エラーメッセージ表示のプロパティテストを作成 (P)
  - **Property 34: エラーメッセージの表示**
  - **検証対象: 要件 10.1**
  - _Requirements: 10.1_

- [ ] 8.2 エラーメッセージ内容のプロパティテストを作成 (P)
  - **Property 35: エラーメッセージの内容**
  - **検証対象: 要件 10.2**
  - _Requirements: 10.2_

- [ ] 8.3 致命的エラーのロギングテストを作成 (P)
  - **Property 36: 致命的エラーのロギング**
  - **検証対象: 要件 10.5**
  - _Requirements: 10.5_

- [x] 9. チェックポイント - バックエンドテストの確認
  - すべてのテストが合格することを確認し、問題があればユーザーに質問する

- [x] 10. フロントエンド: 認証UI実装
  - LoginFormコンポーネントを実装
  - SessionProviderコンテキストを実装
  - ProtectedRouteラッパーを実装
  - ログアウト機能を実装
  - _Requirements: 1.1, 1.3, 1.5_

- [ ] 10.1 認証UIのユニットテストを作成 (P)
  - LoginFormのレンダリングとインタラクションをテスト
  - SessionProviderの状態管理をテスト
  - _Requirements: 1.1, 1.3, 1.5_

- [x] 11. フロントエンド: Catalogブラウザ実装
  - CatalogListコンポーネントを実装
  - SearchBarコンポーネントを実装（キーワード、カテゴリフィルター）
  - ServerCardコンポーネントを実装
  - Catalog取得とキャッシング（SWR）を実装
  - _Requirements: 3.1, 3.3, 3.4, 8.1, 8.2, 8.4_

- [ ] 11.1 Catalog選択時の設定プレフィルテストを作成 (P)
  - **Property 10: Catalog選択時の設定プレフィル**
  - **検証対象: 要件 3.3**
  - _Requirements: 3.3_

- [ ] 11.2 Catalogブラウザのユニットテストを作成 (P)
  - 検索とフィルタリングのUIインタラクションをテスト
  - _Requirements: 3.1, 3.4, 8.1, 8.2, 8.4_

- [x] 12. フロントエンド: コンテナ管理ダッシュボード実装
  - ContainerListコンポーネントを実装
  - ContainerActionsコンポーネントを実装（起動/停止/再起動/削除）
  - LogViewerコンポーネントを実装（WebSocket）
  - ContainerConfiguratorフォームを実装
  - ステータス監視とリアルタイム更新を実装
  - _Requirements: 4.1, 4.2, 4.3, 4.4, 4.5, 9.1, 9.3_

- [ ] 12.1 ステータス表示のプロパティテストを作成 (P)
  - **Property 30: ステータス表示**
  - **検証対象: 要件 9.1**
  - _Requirements: 9.1_

- [ ] 12.2 エラー状態の強調表示テストを作成 (P)
  - **Property 31: エラー状態の強調表示**
  - **検証対象: 要件 9.3**
  - _Requirements: 9.3_

- [ ] 12.3 コンテナ詳細情報取得のプロパティテストを作成 (P)
  - **Property 32: コンテナ詳細情報の取得**
  - **検証対象: 要件 9.4**
  - _Requirements: 9.4_

- [ ] 12.4 Docker通信失敗のエラーハンドリングテストを作成 (P)
  - **Property 33: Docker通信失敗のエラーハンドリング**
  - **検証対象: 要件 9.5**
  - _Requirements: 9.5_

- [ ] 12.5 コンテナ管理のユニットテストを作成 (P)
  - コンテナ操作ボタンのインタラクションをテスト
  - ログストリーミングの表示をテスト
  - _Requirements: 4.1, 4.2, 4.3, 4.4, 4.5, 9.1, 9.3, 9.4, 9.5_

- [x] 13. フロントエンド: Gateway Config エディター実装
  - ConfigFormコンポーネントを実装
  - SecretReferenceInputコンポーネントを実装（Bitwarden参照記法サポート）
  - ConfigValidatorを実装（リアルタイムバリデーション）
  - 設定の読み込み・保存機能を実装
  - _Requirements: 5.1, 5.2, 5.3, 5.4, 5.5_

- [ ] 13.1 Gateway Config エディターのユニットテストを作成 (P)
  - フォーム入力とバリデーションをテスト
  - Bitwarden参照記法の入力をテスト
  - _Requirements: 5.1, 5.2, 5.3, 5.4, 5.5_

- [x] 14. フロントエンド: MCP Inspector実装
  - InspectorPanelコンポーネントを実装（タブUI）
  - ToolsListコンポーネントを実装
  - ResourcesListコンポーネントを実装
  - PromptsListコンポーネントを実装
  - MCP機能情報の取得と表示を実装
  - _Requirements: 6.1, 6.2, 6.3, 6.4, 6.5_

- [ ] 14.1 MCP Inspectorのユニットテストを作成 (P)
  - 各タブの表示とデータレンダリングをテスト
  - _Requirements: 6.1, 6.2, 6.3, 6.5_

- [x] 15. フロントエンド: 共通UIコンポーネント実装
  - エラートースト通知コンポーネントを実装
  - ローディングインジケーターコンポーネントを実装
  - 確認ダイアログコンポーネントを実装
  - 成功メッセージ表示を実装
  - _Requirements: 10.1, 10.2, 10.4_

- [ ] 15.1 共通UIコンポーネントのユニットテストを作成 (P)
  - 各コンポーネントのレンダリングをテスト
  - _Requirements: 10.1, 10.2, 10.4_

- [x] 16. フロントエンド: ルーティングとレイアウト実装
  - App Routerのページ構造を作成
  - ナビゲーションメニューを実装
  - レスポンシブレイアウトを実装
  - 認証保護されたルートを設定
  - _Requirements: すべての要件の統合_

- [x] 17. チェックポイント - フロントエンドテストの確認
  - すべてのテストが合格することを確認し、問題があればユーザーに質問する

- [x] 18. 統合とE2Eテスト
  - Docker Compose設定を完成させる
  - フロントエンドとバックエンドの統合を確認
  - 主要なユーザーフローのE2Eテストを作成（Playwright）
  - _Requirements: すべての要件_

- [ ] 18.1 E2Eテストを作成
  - ログインからコンテナ起動までのフローをテスト
  - Catalogからのインストールフローをテスト
  - MCP Inspectorの使用フローをテスト
  - _Requirements: すべての要件_

- [x] 19. ドキュメントとデプロイメント準備
  - README.mdを作成（セットアップ手順、使用方法）
  - 環境変数のドキュメントを作成
  - デプロイメントガイドを作成
  - サンプルCatalog JSONを作成
  - _Requirements: すべての要件のサポート_

- [ ] 20. 最終チェックポイント
  - すべてのテストが合格することを確認し、問題があればユーザーに質問する
