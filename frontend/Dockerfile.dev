FROM node:22.12.0-alpine

WORKDIR /app

# Minimal base deps for Playwright/headless chromium (apk; alpine base)
RUN apk add --no-cache \
    ca-certificates \
    curl \
    nss \
    ttf-dejavu \
    ttf-liberation \
    ttf-droid \
    ttf-freefont \
    ttf-opensans

# Copy package files
COPY package.json package-lock.json* ./

# Install dependencies
RUN npm ci

# Install Playwright browsers for E2E (headless chromium)
# Alpineにはaptが無いため --with-deps は使わず、上の apk で依存を用意したうえでブラウザのみ取得する
RUN npx playwright install chromium

# Copy application files
COPY . .

# Expose port
EXPOSE 3000

# Start development server
CMD ["npm", "run", "dev"]
